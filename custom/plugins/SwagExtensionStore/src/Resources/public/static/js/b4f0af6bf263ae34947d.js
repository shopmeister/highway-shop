(window["webpackJsonpPluginswag-extension-store"]=window["webpackJsonpPluginswag-extension-store"]||[]).push([[645],{6829:function(){},1645:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return r}}),s(1107);var r=Shopware.Component.wrapComponentConfig({template:'{% block sw_in_app_purchase_checkout_modal %}\n<sw-modal\n    v-if="store.entry"\n    class="sw-in-app-purchase-checkout"\n    :title="$tc(\'sw-in-app-purchase-checkout.modalTitle\')"\n    @modal-close="handleStateActions(false)"\n>\n    <template v-if="state === \'purchase\'" #modal-title>\n        <sw-extension-icon\n            class="sw-in-app-purchase-checkout__icon"\n            :src="extensionIcon"\n        />\n\n        <div class="sw-in-app-purchase-checkout__titles">\n            <h4 id="modalTitleEl" class="sw-modal__title">\n                {{ $tc(\'sw-in-app-purchase-checkout.modalTitle\') }}\n            </h4>\n\n            <h5 class="sw-modal__subtitle">\n                {{ extension.label }}\n            </h5>\n        </div>\n    </template>\n\n    <sw-in-app-purchase-checkout-overview\n        v-if="state === \'purchase\'"\n        v-model:tos-accepted="tosAccepted"\n        v-model:gtc-accepted="gtcAccepted"\n        v-model:variant="variant"\n        :purchase="purchase"\n        :producer="extension.producerName"\n        :cart="inAppPurchaseCart"\n        @update:variant="createCart"\n    />\n\n    <sw-in-app-purchase-checkout-state\n        v-if="[\'loading\', \'success\', \'error\'].includes(state)"\n        :state="state"\n        :error="errorMessage"\n    />\n\n    <template #modal-footer>\n        <sw-in-app-purchase-checkout-button\n            :state="state"\n            :tos-accepted="tosAccepted"\n            :gtc-accepted="gtcAccepted"\n            :variant="variant"\n            @click="handleStateActions(true)"\n        />\n    </template>\n</sw-modal>\n{% endblock %}\n',inject:["inAppPurchasesService"],mixins:[Shopware.Mixin.getByName("notification")],data(){return{state:"loading",store:Shopware.Store.get("inAppPurchaseCheckout"),inAppPurchaseCart:null,extension:null,purchase:null,tosAccepted:!1,gtcAccepted:!1,variant:null,errorMessage:null}},created(){this.createdComponent()},computed:{assetFilter(){return Shopware.Filter.getByName("asset")},extensionIcon(){return this.extension?.icon?this.extension.icon:this.extension?.iconRaw?`data:image/png;base64, ${this.extension.iconRaw}`:this.assetFilter("administration/static/img/theme/default_theme_preview.jpg")},storeExtension(){let e=this.store.extension;return(Shopware.Utils.types.isObject(e)?e?.name:e)??""}},methods:{createdComponent(){this.store.$subscribe(()=>{this.requestFeature()})},createCart(e){if(!this.store.extension||!this.store.entry||!e){this.reset();return}this.variant=e,this.state="loading",this.inAppPurchasesService.createCart(this.store.extension,this.store.entry.identifier,e).then(e=>{this.inAppPurchaseCart=e,this.state="purchase"}).catch(e=>{Shopware.Utils.debug.error("checkout-iap",e),this.errorMessage=this.getError(e),this.state="error"})},async requestFeature(){if(!this.store.extension||!this.store.entry){this.reset();return}this.state="loading",await Promise.all([this.inAppPurchasesService.getExtension(this.store.extension),this.inAppPurchasesService.getPriceModels(this.store.extension,this.store.entry.identifier)]).then(([e,t])=>{if(this.extension=e,this.purchase=t,!this.purchase)throw Error("No in-app purchase foud");return this.createCart(this.purchase.preselectedVariant)}).catch(e=>{Shopware.Utils.debug.error("checkout-iap",e),this.errorMessage=this.getError(e),this.state="error"})},onPurchaseFeature(){if(!this.inAppPurchaseCart||!this.extension){this.reset();return}this.inAppPurchasesService.orderCart(this.inAppPurchaseCart.taxRate,this.inAppPurchaseCart.positions,this.extension.name).then(()=>{this.state="success"}).catch(e=>{Shopware.Utils.debug.error("checkout-iap",e),this.errorMessage=this.getError(e),this.state="error"})},handleStateActions(e){switch(this.state){case"purchase":e?this.onPurchaseFeature():this.reset();break;case"error":e?this.requestFeature():this.reset();break;case"success":this.reset(),this.inAppPurchasesService.refreshInAppPurchases().then(()=>{window.location.reload()});break;default:this.reset()}},getError(e){return e?.response?.data.errors[0]?.apiCode??null},reset(){this.store.dismiss(),this.inAppPurchaseCart=null,this.extension=null,this.errorMessage=null,this.state="loading",this.purchase=null,this.variant=null,this.tosAccepted=!1,this.gtcAccepted=!1}}})},1107:function(e,t,s){var r=s(6829);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),s(5346).Z("412add6c",r,!0,{})},5346:function(e,t,s){"use strict";function r(e,t){for(var s=[],r={},n=0;n<t.length;n++){var a=t[n],i=a[0],o={id:e+":"+n,css:a[1],media:a[2],sourceMap:a[3]};r[i]?r[i].parts.push(o):s.push(r[i]={id:i,parts:[o]})}return s}s.d(t,{Z:function(){return f}});var n="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!n)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var a={},i=n&&(document.head||document.getElementsByTagName("head")[0]),o=null,c=0,h=!1,u=function(){},p=null,l="data-vue-ssr-id",d="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,s,n){h=s,p=n||{};var i=r(e,t);return g(i),function(t){for(var s=[],n=0;n<i.length;n++){var o=a[i[n].id];o.refs--,s.push(o)}t?g(i=r(e,t)):i=[];for(var n=0;n<s.length;n++){var o=s[n];if(0===o.refs){for(var c=0;c<o.parts.length;c++)o.parts[c]();delete a[o.id]}}}}function g(e){for(var t=0;t<e.length;t++){var s=e[t],r=a[s.id];if(r){r.refs++;for(var n=0;n<r.parts.length;n++)r.parts[n](s.parts[n]);for(;n<s.parts.length;n++)r.parts.push(v(s.parts[n]));r.parts.length>s.parts.length&&(r.parts.length=s.parts.length)}else{for(var i=[],n=0;n<s.parts.length;n++)i.push(v(s.parts[n]));a[s.id]={id:s.id,refs:1,parts:i}}}}function m(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function v(e){var t,s,r=document.querySelector("style["+l+'~="'+e.id+'"]');if(r){if(h)return u;r.parentNode.removeChild(r)}if(d){var n=c++;t=x.bind(null,r=o||(o=m()),n,!1),s=x.bind(null,r,n,!0)}else t=C.bind(null,r=m()),s=function(){r.parentNode.removeChild(r)};return t(e),function(r){r?(r.css!==e.css||r.media!==e.media||r.sourceMap!==e.sourceMap)&&t(e=r):s()}}var w=function(){var e=[];return function(t,s){return e[t]=s,e.filter(Boolean).join("\n")}}();function x(e,t,s,r){var n=s?"":r.css;if(e.styleSheet)e.styleSheet.cssText=w(t,n);else{var a=document.createTextNode(n),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function C(e,t){var s=t.css,r=t.media,n=t.sourceMap;if(r&&e.setAttribute("media",r),p.ssrId&&e.setAttribute(l,t.id),n&&(s+="\n/*# sourceURL="+n.sources[0]+" */\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}}}]);