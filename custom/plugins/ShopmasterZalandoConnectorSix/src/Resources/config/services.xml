<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd">

    <imports>
        <import resource="./services/*.xml"/>
    </imports>

    <parameters>
        <parameter key="ShopmasterZalandoConnectorSix.pluginName">ShopmasterZalandoConnectorSix</parameter>
    </parameters>

    <services>
        <defaults public="true"/>

        <!-- CORE-->
        <service id="ShopmasterZalandoConnectorSix\Core\Framework\MessageQueue\StructCollectionMessageJsonSerializer">
            <tag name="serializer.normalizer"/>
        </service>
        <!--END CORE -->

        <!-- LICENSE SYSTEM -->
        <service id="ShopmasterZalandoConnectorSix\Services\License\ShopwareStoreApiClient">
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Logger"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\Services\License\LicenseService">
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="cache.app"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Logger"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\License\ShopwareStoreApiClient"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\Services\License\SalesChannelGuard">
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\License\LicenseService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Logger"/>
        </service>
        <!-- END LICENSE SYSTEM -->

        <service id="ShopmasterZalandoConnectorSix\Monolog\Handler\RotatingFileHandler" class="Monolog\Handler\RotatingFileHandler">
            <argument type="string">%kernel.logs_dir%/%ShopmasterZalandoConnectorSix.pluginName%.log</argument>
            <argument>20</argument>
            <argument>100</argument>
        </service>


        <service id="ShopmasterZalandoConnectorSix\Logger" class="Monolog\Logger">
            <call method="pushHandler">
                <argument type="service" id="ShopmasterZalandoConnectorSix\Monolog\Handler\RotatingFileHandler"/>
            </call>
            <argument>%ShopmasterZalandoConnectorSix.pluginName%</argument>
        </service>

        <service id="ShopmasterZalandoConnectorSix\Services\Config\ConfigService">
            <argument>%ShopmasterZalandoConnectorSix.pluginName%</argument>
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="custom_field.repository"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\Services\HttpClient\ClientService">
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Logger"/>
            <argument type="service" id="event_dispatcher"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\DevCache" class="Symfony\Component\Cache\Adapter\FilesystemAdapter">
            <argument>%ShopmasterZalandoConnectorSix.pluginName%</argument>
            <argument>7200</argument>
            <argument>%kernel.cache_dir%/%ShopmasterZalandoConnectorSix.pluginName%</argument>
        </service>

        <!-- Listing Services -->
        <service id="ShopmasterZalandoConnectorSix\Services\Api\Zalando\Product\ApiZalandoProductService">
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\HttpClient\ClientService"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\Services\Export\Product\Listing\ExportListingService">
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Config\ConfigService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Api\Zalando\Product\ApiZalandoProductService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Api\Zalando\SalesChannels\ApiZalandoSalesChannelsService"/>
            <argument type="service" id="product.repository"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Logger"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\Commands\Listing\ListingSyncCommand">
            <argument type="service" id="ShopmasterZalandoConnectorSix\Logger"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Api\Zalando\Product\ApiZalandoProductPsrService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Config\ConfigService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Api\Zalando\SalesChannels\ApiZalandoSalesChannelsService"/>
            <argument type="service" id="messenger.bus.shopware"/>
            <tag name="console.command"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\Commands\Listing\ListingSyncSingleCommand">
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Config\ConfigService"/>
            <argument type="service" id="product.repository"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Api\Zalando\Product\ApiZalandoProductService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Api\Zalando\SalesChannels\ApiZalandoSalesChannelsService"/>
            <tag name="console.command"/>
        </service>

        <service id="ShopmasterZalandoConnectorSix\MessageQueue\Handler\Export\Product\Listing\ExportListingByPsrHandler">
            <argument type="service" id="ShopmasterZalandoConnectorSix\Services\Export\Product\Listing\ExportListingService"/>
            <argument type="service" id="ShopmasterZalandoConnectorSix\Logger"/>
            <tag name="messenger.message_handler"/>
        </service>
        <!-- END Listing Services -->

    </services>
</container>