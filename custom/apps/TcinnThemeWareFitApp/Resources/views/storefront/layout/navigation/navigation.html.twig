{# @deprecated tag:v6.7.0 - This template will be removed, use src/Storefront/Resources/views/storefront/layout/navbar/navbar.html.twig #}
{% sw_extends '@Storefront/storefront/layout/navigation/navigation.html.twig' %}

{# @TODO: prüfen... #}

{# ---------------- START: SET TEMPLATE VARS ---------------- #}

{# ThemeWare: Set theme variables #}
{% set twtIconSet = theme_config('twt-iconset') %}
{% set twtNavMainArrowsShow = theme_config('twt-nav-main-arrows-show') %}
{% set twtNavMainHomeLink = theme_config('twt-nav-main-home-link') %}
{% set twtNavMainHomeLinkCompatibility = theme_config('twt-nav-main-home-link-compatibility') %}
{% set twtNavMainHomeLinkShow = theme_config('twt-nav-main-home-link-show') %}
{% set twtNavMainMenuItemsCompatibility = theme_config('twt-nav-main-menu-items-compatibility') %}
{% set twtNavMainShow = theme_config('twt-nav-main-show') %}

{% set twtNavMainDropdown = theme_config('twt-nav-main-dropdown') %}
{% set twtNavMainDropdownBoxShadowType = theme_config('twt-nav-main-dropdown-box-shadow-type') %}
{% set twtNavMainDropdownPlugin = theme_config('twt-nav-main-dropdown-plugin') %}

{% set twtNavMainExternalLinksIconShow = theme_config('twt-nav-main-external-links-icon-show') %}

{% if twtNavMainDropdownBoxShadowType == 5 %}
	{% set shadow = 'shadow-sm' %}
{% elseif twtNavMainDropdownBoxShadowType == 6 %}
	{% set shadow = 'shadow' %}
{% elseif twtNavMainDropdownBoxShadowType == 7 %}
	{% set shadow = 'shadow-lg' %}
{% endif %}

{# ---------------- END: SET TEMPLATE VARS ---------------- #}

{# ThemeWare: Adjustments to the main navigation #}
{# @TODO: HC-Architecture... #}
{% block layout_main_navigation %}
	{# ThemeWare: Hide main navigation or add 'Dropdown navigation'. #}
	{% if twtNavMainDropdown == 2 %}
		{# ThemeWare: Add 'Dropdown navigation' if configured. #dropdownNav #beta #}
		<div class="main-navigation twt-main-navigation-dropdown"
			 id="mainNavigation"
			 data-flyout-menu="true"
			 {% if twtNavMainDropdownPlugin == 2 %}
			 	data-twt-dropdown-navigation="true"
			 {% endif %}
		>
			{{ block('layout_main_navigation_navbar') }}

			{# INFO: Remove the "Flyout" (block 'layout_main_navigation_menu_flyout_wrapper') #}
		</div>

	{% elseif twtNavMainShow == 1 or twtNavMainShow == 3 %}
		{# ThemeWare: Clear block #}

	{% else %}
		{# Default block #}
		{{ parent() }}

	{% endif %}
{% endblock %}


{# ThemeWare: Adjustments to the "Home link" in main navigation #}
{# HC-Architecture @Doku #}
{% block layout_main_navigation_menu_home %}
	{# {% if context.salesChannel.translated.homeEnabled %} #}
	{% if twtNavMainHomeLinkCompatibility == 2 %}
		{% if twtNavMainHomeLinkShow > 1 %}
			{# ThemeWare: Add aria-label #}
			<a href="{{ path('frontend.home.page') }}"
			   class="nav-link main-navigation-link nav-item-{{ context.salesChannel.navigationCategoryId }}{% if controllerAction is same as('home') %} active{% endif %} home-link"
			   itemprop="url"
			   title="{{ 'general.homeLink'|trans|striptags }}"
			   aria-label="{{ 'general.homeLink'|trans|striptags }}"
			>
				{% if twtNavMainHomeLink == 1 %}
					{# ThemeWare: "Home text" link (default) #}
					<div class="main-navigation-link-text">
						<span itemprop="name">{{ 'general.homeLink'|trans|sw_sanitize }}</span>
					</div>

				{% elseif twtNavMainHomeLink == 2 %}
					{# ThemeWare: "Home icon" link #}
					{# @TODO tag:v6.7.0 - Check if aria-label or ariaHidden is needed #}
					<div class="main-navigation-icon">
						<span itemprop="name">
							{% if twtIconSet is not same as ('default') %}
								{% sw_icon 'home' style { pack: 'themeware' } %}
							{% else %}
								{% sw_icon 'home' %}
							{% endif %}
						</span>
					</div>

				{% endif %}
			</a>

		{% else %}
			{# INFO: No icon or text configured #}

		{% endif %}

	{% else %}
		{# Default block #}
		{{ parent() }}

	{% endif %}
{% endblock %}


{# ThemeWare: Adjustments to the menu items in main navigation #}
{# @TODO: HC-Architecture @Doku #}
{% block layout_main_navigation_menu_item %}
	{% set customField = treeItem.category.translated.customFields.twt_fit_cloud_custom_field__category__highlighted %}

	{% if twtNavMainMenuItemsCompatibility == 2 %}
		{% if twtNavMainDropdown == 2 %}
			{# ThemeWare: Add 'Dropdown navigation' if configured. #dropdownNav #beta #}
			<div class="nav-link main-navigation-link nav-item-{{ category.id}}{% if customField is not empty and customField == '1' %} highlighted{% endif %}"
				 {# {% if treeItem.children|length > 0 %}
					 data-flyout-menu-trigger="{{ category.id }}"
				 {% endif %} #}
				 title="{{ name }}"
			>
				{% if category.type == 'folder' %}
					<div class="main-navigation-link-text">
						<span itemprop="name">{{ name }}</span>

				{% else %}
					<a href="{{ category_url(category) }}"
					   class="main-navigation-link-text"
					   itemprop="url"
					   title="{{ name }}"
					   {% if category_linknewtab(category) %}target="_blank"{% endif %}
					>
						<span itemprop="name">{{ name }}</span>
				{% endif %}

				{# ThemeWare: Add navigation arrow #}
				{% if twtNavMainArrowsShow == 2 and treeItem.children|length > 0 %}
					{# @TODO tag:v6.7.0 - Check if aria-label or ariaHidden is needed #}
					{% sw_icon 'arrow-medium-down' style { pack: 'solid', size: 'xs', ariaHidden: true } %}
				{% endif %}

				{# Close the <div> or <a> tag depending on the condition #}
				{% if category.type == 'folder' %}
					</div>
				{% else %}
					</a>
				{% endif %}

				{# Add dropdown #}
				{% if twtNavMainDropdown == 2 and treeItem.children|length > 0 %}
					<div class="main-navigation-dropdown twt-main-navigation-dropdown-list{% if shadow %} {{ shadow }}{% endif %}">
						{% for child in treeItem.children %}
							<div class="{{ child.children|length > 0 ? 'main-navigation-dropdown-item has-sub' : 'main-navigation-dropdown-item' }}">
								<a href="{{ seoUrl('frontend.navigation.page', {'navigationId': child.category.id}) }}"
								   class="nav-dropdown-item nav-dropdown-link navigation-dropdown-link is-level-0"
								   title="{{ child.category.translated.name|escape }}"
								>
									{{ child.category.translated.name }}
								</a>

								{# Add sub menu #}
								{% if child.children|length > 0 %}
									<div class="main-navigation-dropdown-sub-menu{% if shadow %} {{ shadow }}{% endif %}"">
										{% for subChild in child.children %}
											<div class="main-navigation-dropdown-sub-menu-item">
												<a href="{{ seoUrl('frontend.navigation.page', {'navigationId': subChild.category.id}) }}"
												   class="nav-dropdown-item nav-dropdown-link navigation-dropdown-link is-level-1{% if twtNavMainExternalLinksIconShow == 2 and subChild.category.type == 'link' and subChild.category.translated.linkType == 'external' %} d-flex{% endif %}"
												   title="{{ subChild.category.translated.name|escape }}"
												>
													{{ subChild.category.translated.name }}

													{# ThemeWare: Add icon to external links #}
													{% if twtNavMainExternalLinksIconShow == 2 and subChild.category.type == 'link' and subChild.category.translated.linkType == 'external' %}
														<span class="icon icon-box-arrow-up-right">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-up-right" viewBox="0 0 16 16">
																<path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
																<path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>
															</svg>
														</span>
													{% endif %}
												</a>
											</div>
										{% endfor %}
									</div>
								{% endif %}
							</div>
						{% endfor %}
					</div>
				{% endif %}
			</div>

		{% else %}
			{# ThemeWare: Adjust main navigation #}
			{% if category.type == 'folder' %}
				<div class="nav-link main-navigation-link nav-item-{{ category.id}}{% if customField is not empty and customField == '1' %} highlighted{% endif %}"
					 {% if treeItem.children|length > 0 %}
						data-flyout-menu-trigger="{{ category.id }}"
					 {% endif %}
					 title="{{ name }}"
				>
					<div class="main-navigation-link-text">
						<span itemprop="name">{{ name }}</span>

						{# ThemeWare: Add navigation arrow #}
						{% if twtNavMainArrowsShow == 2 and treeItem.children|length > 0 %}
							{# @TODO tag:v6.7.0 - Check if aria-label or ariaHidden is needed #}
							{% sw_icon 'arrow-medium-down' style { pack: 'solid', size: 'xs', ariaHidden: true } %}
						{% endif %}
					</div>
				</div>

			{% else %}
				<a href="{{ category_url(category) }}"
				   class="nav-link 1 main-navigation-link nav-item-{{ category.id}}{% if customField is not empty and customField == '1' %} highlighted{% endif %}{% if category.id == page.header.navigation.active.id or category.id in activePath %} active{% endif %}"
				   itemprop="url"
				   {% if treeItem.children|length > 0 %}data-flyout-menu-trigger="{{ category.id }}"{% endif %}
				   title="{{ name }}"
				   {% if category_linknewtab(category) %}target="_blank"{% endif %}
				>
					<div class="main-navigation-link-text">
						<span itemprop="name">{{ name }}</span>

						{# ThemeWare: Add navigation arrow #}
						{% if twtNavMainArrowsShow == 2 and treeItem.children|length > 0 %}
							{# @TODO tag:v6.7.0 - Check if aria-label or ariaHidden is needed #}
							{% sw_icon 'arrow-medium-down' style { pack: 'solid', size: 'xs', ariaHidden: true } %}
						{% endif %}
					</div>
				</a>
			{% endif %}
		{% endif %}

	{% else %}
		{# Default block #}
		{{ parent() }}

	{% endif %}

{% endblock %}